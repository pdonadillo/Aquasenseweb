<!-- this is index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaSense - Smart Aquaculture Management Platform</title>
    <link rel="stylesheet" href="main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Hide all sign up elements - can be shown via console command "show" */
        .hide-signup {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="brand">
                <img
                    src="assets/images/logo/aquasence.logo.png"
                    alt="AquaSense Logo"
                    class="app-logo"
                />
                <span class="brand-text">AquaSense</span>
            </div>
            <div class="nav-menu">
                <a href="#home" class="nav-link">Home</a>
                <a href="#features" class="nav-link">Features</a>
                <a href="#about" class="nav-link">About</a>
            </div>
            <div class="nav-auth">
                <button class="btn-login" onclick="openModal('loginModal')">Login</button>
                <button class="btn-signup hide-signup" onclick="openModal('signupModal')">Sign Up</button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="hero-container">
            <div class="hero-content">
                <h1 class="hero-title">Welcome to <span class="highlight">AquaSense</span></h1>
                <p class="hero-subtitle">Aquaculture management platform that combines IoT technology, automated feeding, and data analytics</p>
                <p class="hero-description">
                    AquaSense helps fish farmers monitor water quality,and make better decisions anytime, anywhere. 
                    Our comprehensive platform integrates cutting-edge IoT sensors, automated feeding systems, and analytics 
                    to optimize your aquaculture operations and maximize productivity.
                </p>
                <div class="hero-buttons">
                    <button class="btn-primary hide-signup" onclick="openModal('signupModal')">
                        <i class="fas fa-rocket"></i>
                        Get Started
                    </button>
                    <button class="btn-secondary" onclick="scrollToSection('features')">
                        <i class="fas fa-play"></i>
                        Learn More
                    </button>
                </div>
            </div>
            <div class="hero-image">
                <div class="water-animation">
                    <i class="fas fa-tint water-drop"></i>
                    <i class="fas fa-tint water-drop"></i>
                    <i class="fas fa-tint water-drop"></i>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features">
        <div class="container">
            <h2 class="section-title">Why Choose AquaSense?</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-tint"></i>
                    </div>
                    <h3>Water Quality Monitoring</h3>
                    <p>Monitors your pond's pH, temperature, oxygen, and ammonia in real time.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3>Scheduled Feeding</h3>
                    <p>Automatically feeds your fish at the times you set.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <h3>Mortality Logging</h3>
                    <p>Record fish deaths quickly and keep track with ease.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <h3>Data Analytics & Reporting</h3>
                    <p>View simple daily, weekly, or monthly summaries.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Mobile App Access</h3>
                    <p>Check your farm anytime, anywhere on your phone.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <h3>Cloud Storage</h3>
                    <p>Keeps all your farm data safe and accessible.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <h2>About AquaSense</h2>
                    <p>
                        AquaSense is an IoT-Based Aquaculture Management System with Data Analytics designed to support fish farmers in making aquaculture smarter, easier, and more sustainable.
                    </p>
                    <p>
                        The system was developed as an undergraduate capstone project by BS Information Technology students of Samar State University. It integrates IoT sensors, scheduled feeding, mortality logging, data analytics, and mobile access into one platform, giving farmers real-time insights into their fishponds.
                    </p>
                    <p>
                        Our goal is to help local aquaculture communities reduce feed waste, prevent sudden losses, and improve productivity by providing a low-cost, practical, and farmer-friendly solution. By combining modern technology with everyday farming practices, AquaSense empowers smallholder fish farmers to achieve better harvests and contribute to food security in their communities.
                    </p>
                </div>
                <div class="about-image">
                    <div class="water-visualization">
                        <i class="fas fa-tint"></i>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <div class="cta-content">
                <h2>Join us and make your aquaculture operations efficient and easier</h2>
                <div class="cta-buttons">
                    <button class="btn-primary hide-signup" onclick="openModal('signupModal')">
                        <i class="fas fa-user-plus"></i>
                        Create Account
                    </button>
                    <button class="btn-outline" onclick="openModal('loginModal')">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-tint"></i>
                        <span>AquaSense</span>
                    </div>
                    <p>Empowering aquaculture excellence through IOT Integrated technologies</p>
                </div>
                <div class="footer-section">
                    <h4>Founders</h4>
                    <ul>
                        <li>P. Donadillo</li>
                        <li>A. Verzosa</li>
                        <li>S. Dela Cruz</li>
                        <li>C. Crisanto</li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Help Center</a></li>
                        <li><a href="#">Documentation</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <ul>
                        <li><i class="fas fa-envelope"></i> <span id="contactEmail">--</span></li>
                        <li><i class="fas fa-phone"></i> <span id="contactPhone">--</span></li>
                        <li><i class="fas fa-map-marker-alt"></i> <span id="contactAddress">--</span></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2026 AquaSense. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <div class="modal-header">
                <h2>Welcome Back</h2>
                <p>Sign in to your AquaSense account</p>
            </div>
            <form class="auth-form" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email Address</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox">
                        <span class="checkmark"></span>
                        Remember me
                    </label>
                    <a href="#" class="forgot-password">Forgot password?</a>
                </div>
                <button type="submit" class="btn-primary full-width">Sign In</button>
                <div class="auth-divider hide-signup">
                    <span>or</span>
                </div>
                <button type="button" class="btn-google hide-signup">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>
            </form>
            <div class="modal-footer">
                <p class="hide-signup">Don't have an account? <a href="#" onclick="switchModal('loginModal', 'signupModal')">Sign up</a></p>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div id="signupModal" class="modal hide-signup">
        <div class="modal-content">
            <span class="close" onclick="closeModal('signupModal')">&times;</span>
            <div class="modal-header">
                <h2>Join AquaSense</h2>
                <p>Create your account and start optimizing your aquaculture operations today</p>
            </div>
            <form class="auth-form" id="signupForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="signupFirstName">First Name</label>
                        <input type="text" id="signupFirstName" required>
                    </div>
                    <div class="form-group">
                        <label for="signupLastName">Last Name</label>
                        <input type="text" id="signupLastName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email Address</label>
                    <input type="email" id="signupEmail" required>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required>
                </div>
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" required>
                </div>
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" required>
                        <span class="checkmark"></span>
                        I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>
                    </label>
                </div>
                <button type="submit" class="btn-primary full-width">Create Account</button>
                <div class="auth-divider hide-signup">
                    <span>or</span>
                </div>
                <button type="button" class="btn-google hide-signup">
                    <i class="fab fa-google"></i>
                    Continue with Google
                </button>
            </form>
            <div class="modal-footer">
                <p>Already have an account? <a href="#" onclick="switchModal('signupModal', 'loginModal')">Sign in</a></p>
            </div>
        </div>
    </div>

    <!-- Inline fallback to ensure openModal is available immediately (before modules load) -->
    <script>
        // Minimal fallback - will be replaced by main.js when it loads
        window.openModal = window.openModal || function(modalId) {
            console.warn('[FALLBACK] openModal called before module load, modal:', modalId);
            // Try to find and show modal manually as fallback
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        };
        window.closeModal = window.closeModal || function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        };
        window.switchModal = window.switchModal || function(fromId, toId) {
            window.closeModal(fromId);
            window.openModal(toId);
        };
        
        // Function to show all sign up elements
        function showSignupElements() {
            const elements = document.querySelectorAll('.hide-signup');
            elements.forEach(el => {
                el.classList.remove('hide-signup');
            });
            console.log('%câœ… Sign up elements are now visible!', 'color: green; font-weight: bold; font-size: 14px;');
        }
        
        // Expose as window function for console access - user can type "show" or "show()"
        window.show = showSignupElements;
        
        // Override console methods to detect "show" command
        const originalLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ').toLowerCase();
            if (message === 'show' || message.trim() === 'show') {
                showSignupElements();
                return;
            }
            originalLog.apply(console, args);
        };
        
        // Also detect when user evaluates "show" in console
        const originalEval = window.eval;
        window.eval = function(code) {
            const trimmed = String(code).trim().toLowerCase();
            if (trimmed === 'show' || trimmed === '"show"' || trimmed === "'show'") {
                showSignupElements();
                return;
            }
            return originalEval.apply(window, arguments);
        };
        
        // Function to hide all sign up elements
        function hideSignupElements() {
            // Add hide-signup class to all sign up related elements
            const signupButton = document.querySelector('.btn-signup');
            const getStartedButton = document.querySelector('.hero-buttons .btn-primary');
            const createAccountButton = document.querySelector('.cta-buttons .btn-primary');
            const signupLink = document.querySelector('#loginModal .modal-footer p');
            const signupModal = document.getElementById('signupModal');
            const googleButtons = document.querySelectorAll('.btn-google');
            const authDividers = document.querySelectorAll('.auth-divider');
            
            [signupButton, getStartedButton, createAccountButton, signupLink, signupModal, ...googleButtons, ...authDividers].forEach(el => {
                if (el) {
                    el.classList.add('hide-signup');
                }
            });
        }
        
        // Hide sign up elements on page load
        window.addEventListener('DOMContentLoaded', function() {
            hideSignupElements();
            console.log('%cðŸ”’ Sign up elements are hidden. Type "show" in console to reveal them.', 'color: orange; font-weight: bold;');
        });
        
        // Also hide after a short delay to ensure all elements are loaded
        setTimeout(hideSignupElements, 100);
    </script>
    <script type="module" src="firebase-init.js"></script>
    <script type="module" src="main.js"></script>
    <!-- Background runtime bootstrap: Runs RTDB listeners, feeding schedules, RTDBâ†’Firestore sync, and rollups on index page -->
    <!-- This runs completely in the background - no UI required -->
    <script type="module">
        import { 
            bootRuntimeCore, 
            writeHourlyFromRTDB, 
            startHourlySampler,
            runRollupsForCurrentContext
        } from './dashboard.js';
        
        // Boot runtime core (idempotent - safe to call multiple times)
        // This handles: device setup, RTDB listeners, feeding schedules, rollups
        // Feeding schedules are automatically started via setupFeedingScheduleExecutionCore()
        bootRuntimeCore({sourcePage: 'index'});
        
        // Additional background tasks that run continuously
        (async function startBackgroundRuntime() {
            // Wait for Firebase to initialize
            await new Promise(resolve => {
                if (window.RUNTIME_CONTEXT) {
                    resolve();
                } else {
                    // Poll for runtime context (max 10 seconds)
                    let attempts = 0;
                    const checkInterval = setInterval(() => {
                        attempts++;
                        if (window.RUNTIME_CONTEXT || attempts > 20) {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 500);
                }
            });
            
            // Start hourly RTDB to Firestore sync (runs every 5 minutes)
            // This ensures sensor data from RTDB is written to Firestore hourly records
            if (!window.__HOURLY_WRITE_TIMER__) {
                window.__HOURLY_WRITE_TIMER__ = setInterval(async () => {
                    try {
                        const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                        if (uid) {
                            console.log('[BACKGROUND] Writing hourly data from RTDB to Firestore');
                            await writeHourlyFromRTDB(uid).catch(err => {
                                console.error('[BACKGROUND] Hourly write error:', err);
                            });
                        }
                    } catch (error) {
                        console.error('[BACKGROUND] Hourly write timer error:', error);
                    }
                }, 5 * 60 * 1000); // Every 5 minutes
                
                // Run immediately on first load (after a short delay for RTDB data to populate)
                setTimeout(async () => {
                    const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                    if (uid) {
                        await writeHourlyFromRTDB(uid).catch(err => {
                            console.error('[BACKGROUND] Initial hourly write error:', err);
                        });
                    }
                }, 10000); // Wait 10 seconds for RTDB data to populate
                
                console.log('[BACKGROUND] Hourly RTDBâ†’Firestore sync started');
            }
            
            // Start hourly sampler (runs every 5 minutes)
            // This samples current hour sensor data and updates hourly records
            if (!window.__HOURLY_SAMPLER_STARTED__) {
                const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                if (uid) {
                    startHourlySampler(uid);
                    window.__HOURLY_SAMPLER_STARTED__ = true;
                    console.log('[BACKGROUND] Hourly sampler started');
                } else {
                    // Retry when runtime context is available
                    const retryInterval = setInterval(() => {
                        const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                        if (uid) {
                            clearInterval(retryInterval);
                            startHourlySampler(uid);
                            window.__HOURLY_SAMPLER_STARTED__ = true;
                            console.log('[BACKGROUND] Hourly sampler started (retry)');
                        }
                    }, 2000);
                }
            }
            
            // Run rollups periodically (every 10 minutes)
            // Note: bootRuntimeCore also sets up rollups, but this ensures it runs even if bootRuntimeCore hasn't completed
            if (!window.__ROLLUP_TIMER__) {
                window.__ROLLUP_TIMER__ = setInterval(async () => {
                    try {
                        const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                        if (uid) {
                            console.log('[BACKGROUND] Running rollups');
                            await runRollupsForCurrentContext().catch(err => {
                                console.error('[BACKGROUND] Rollup error:', err);
                            });
                        }
                    } catch (error) {
                        console.error('[BACKGROUND] Rollup timer error:', error);
                    }
                }, 10 * 60 * 1000); // Every 10 minutes
                
                // Run immediately on first load
                setTimeout(async () => {
                    const uid = window.RUNTIME_CONTEXT?.runtimeUid || null;
                    if (uid) {
                        await runRollupsForCurrentContext().catch(err => {
                            console.error('[BACKGROUND] Initial rollup error:', err);
                        });
                    }
                }, 15000); // Wait 15 seconds for data to be available
                
                console.log('[BACKGROUND] Rollup timer started');
            }
            
            console.log('[BACKGROUND] Index page background runtime fully initialized');
            console.log('[BACKGROUND] Feeding schedules are running via bootRuntimeCore â†’ setupFeedingScheduleExecutionCore()');
        })();
    </script>
</body>
</html>
